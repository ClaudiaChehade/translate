<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>How to use NSYS to profiling standard application performance - wave 3 development</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

    </head>

<body pageid="2458153956">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">wave3</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="2458153956_PER.html" class="ht-space-link">
                    <h2>wave 3 development</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=3981344302"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="2458153956_PER.html">wave 3 development</a></li>
                                                                                     <li><a href="3128583610_PER_Real-Time_Performance.html">PER Real-Time Performance</a></li>
                                                            </ul>
</div>            <h1 id="src-3981344302"> <span>How to use NSYS to profiling standard application performance</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-3981344302_safe-id-SG93dG91c2VOU1lTdG9wcm9maWxpbmdzdGFuZGFyZGFwcGxpY2F0aW9ucGVyZm9ybWFuY2Ut6IOM5pmv">
        <h1 class="heading "><span> background </span></h1>
<p   
> It is confirmed with NV that only the detailed reasoning information of the GPU can be used under the Standard to use NSYS, and the NSYS report can be used to clear the details of the GPU RUN. </p>
<p   
> Before we completed the code of code of Standard & Safety and only use the Safety model. </p>
    </div>
    <div class="section section-1" id="src-3981344302_safe-id-SG93dG91c2VOU1lTdG9wcm9maWxpbmdzdGFuZGFyZGFwcGxpY2F0aW9ucGVyZm9ybWFuY2Ut57yW6K-R">
        <h1 class="heading "><span> Compile </span></h1>
<ul class=" "><li class=" "><p   
> Stranged & Bottom Soft </p>
<ul class=" "><li class=" "><p   
> Terrace IP 10.178.229.174 </p>
</li><li class=" "><p   
> It can be troublesome to integrate colleagues LAN Feifei to help CCPLEX and MCU. The latest date is 01111 </p>
<ul class=" "><li class=" "><p   
><a  class="external-link" href="https://rb-cmbinex-sghk-p1.apac.bosch.com/ui/repos/tree/General/wave3-repos/CCPLEX-PR/PR-3118/WAVE3-CCPLEX-PR3118-a03d89f7b8016632e4b25e1f0ccab6ce5313dc39/variant/WAVE3-CCPLEX-PR3118-a03d89f7b8016632e4b25e1f0ccab6ce5313dc39-SWUPDATE-SafetyDbg-GETK-C0-Signed.zip">https://rb-cmbinex-sghk-p1.apac.bosch.com/ui/repos/tree/General/wave3-repos/CCPLEX-PR/PR-3118/WAVE3-CCPLEX-PR3118-a03d89f7b8016632e4b25e1f0ccab6ce5313dc39/variant/WAVE3-CCPLEX-PR3118-a03d89f7b8016632e4b25e1f0ccab6ce5313dc39-SWUPDATE-SafetyDbg-GETK-C0-Signed.zip</a></p>
</li><li class=" "><p   
> MCU is <a  class="external-link" href="https://rb-cmbinex-sghk-p1.apac.bosch.com/ui/repos/tree/General/wave3/MCUCHERY/WAVE3-MCUCHERY-develop-202401120101CST/variant">https://rb-cmbinex-sghk-p1.apac.bosch.com/ui/repos/tree/General/wave3/MCUCHERY/WAVE3-MCUCHERY-develop-202401120101CST/variant</a></p>
</li></ul></li><li class=" "><p   
> The brush is the same as SafeTy </p>
</li></ul></li><li class=" "><p   
> ASW branch </p>
<ul class=" "><li class=" "><p   
> Yin Micheal temporarily maintains a set of root software that can pass the Standard Compile. The branch is <span style="color: #172b4d;">
feature/CNWVIII-78998-planning-standard-build-set-up    </span>
</p>
<ul class=" "><li class=" "><p   
> ASW Base package with good compiles \\ <a  class="external-link" href="http://bosch.com">bosch.com</a>\dfsrb\DfsCN\DIV\XC\Engineering\domain\WAVE3\04_PER\08_ENG\nsys_report\WAVE3-ASW-feature_CNWVIII-78998-planning-standard-build-set-up-202401171054CST-Chery_Camera_Debug.zip</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #172b4d;"> It is recommended to use the one-flow method of compile viprparking of the Activity, and copy it to replace the test (the library file is also replaced by the test) </span>
</p>
</li></ul></li><li class=" "><p   
> Compile instruction </p>
<ul class=" "><li class=" "><p   
> Propose <span style="color: #172b4d;"> Feature/CNWVIII-78998-Planning-Standard-Build-SET-UP branch updates the sub-branch of Perception </span>
</p>
</li><li class=" "><p   
>    <span style="color: #172b4d;">
<a   href="https://inside-docupedia.bosch.com/confluence/display/PJW3PER/how+to+one-flow-build+perception+project+with+pj-w3-root">how to one-flow-build perception project with pj-w3-root - PJ-W3-PER - Docupedia (bosch.com)</a>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #172b4d;"> Compile Viperparking instruction </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">./root_build.sh -o qnx -d B_Sample_L2++/DualOrinMaster -b asw/perception/parking -r OFF -m ON -V chery -j`nproc`</code></div>
</div>
    </div>
</li></ul></li></ul>    </div>
    <div class="section section-1" id="src-3981344302_safe-id-SG93dG91c2VOU1lTdG9wcm9maWxpbmdzdGFuZGFyZGFwcGxpY2F0aW9ucGVyZm9ybWFuY2Ut6L-Q6KGM">
        <h1 class="heading "><span> run </span></h1>
<ul class=" "><li class=" "><p   
> Sample configuration nsys </p>
<ul class=" "><li class=" "><p   
> The configuration of the NSYS environment in our board also needs to modify the soft configuration, and run the script in the board (you need to run every time you restart) </p>
</li><li class=" "><p  class="auto-cursor-target" 
>\\<a  class="external-link" href="http://bosch.com">bosch.com</a>\dfsrb\DfsCN\DIV\XC\Engineering\domain\WAVE3\04_PER\08_ENG\nsys_report\nsys_setup.sh</p>
</li><li class=" "></li></ul></li><li class=" "><p   
> Host PC (ubuntu) install NSYS </p>
<ul class=" "><li class=" "><ul class=" "><li class=" "><p   
> The NSYS version required by DriveOS607 is NSIGHTSYSTEMS-linux-NDA-2023.2.57-3275478.deb. You only need to install it once </p>
</li><li class=" "><p  class="auto-cursor-target" 
>\\<a  class="external-link" href="http://bosch.com">bosch.com</a>\dfsrb\DfsCN\DIV\XC\Engineering\domain\WAVE3\04_PER\08_ENG\nsys_report</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">dpkg -i NsightSystems-linux-nda-</code><code class="value">2023.2</code><code class="plain">.</code><code class="value">2.57</code><code class="plain">-</code><code class="value">3275478</code><code class="plain">.deb</code></div>
</div>
    </div>
</li><li class="auto-cursor-target "><p   
> MOBA-XTERM can start the X11 service and start it directly (every time the board is restarted) </p>
</li><li class="auto-cursor-target "><p   
><img  class="confluence-embedded-image confluence-thumbnail"  src="images/confluence/download/thumbnails/3981344302/image-2024-2-22_14-28-45-version-1-modificationdate-1708655617000-api-v2.png" alt="images/confluence/download/thumbnails/3981344302/image-2024-2-22_14-28-45-version-1-modificationdate-1708655617000-api-v2.png"  height="250" /> Be sure to connect to go to the board to grab nsys, as long as there are errors, it will not succeed. </p>
</li></ul></li></ul></li><li class=" "><p   
> Manually modify running software ESME JSON </p>
<ul class=" "><li class=" "><p   
> Since Driving is not adapted, you need to modify ESME JSON, and only run Parking </p>
</li><li class=" "><p   
> You can replace the dualorinmaster_esme_local.json in the board/data/esme in the board, <a  class="unresolved" href="#src-3981344302">DualOrinMaster_esme_local_parking_noviper.json</a></p>
</li></ul></li><li class=" "><p   
> Manual NSYS startup process </p>
<ul class=" "><li class=" "><p  class="auto-cursor-target" 
> Enter the Run directory, manually activate some environmental variables </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">cd /cache/update/output</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">export ASW_PATH=/cache/update/output/</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">export LD_LIBRARY_PATH=${ASW_PATH}lib_w3:${ASW_PATH}lib_w3/planning:${ASW_PATH}lib_w3/perception:${ASW_PATH}lib_w3/hdmap/lib:${ASW_PATH}lib_aos:${ASW_PATH}lib:/opt/vrte/lib:/opt/app/lib:${LD_LIBRARY_PATH} \</code></div>
<div class="line"><code class="plain">export ASW_PATH=${ASW_PATH} \</code></div>
<div class="line"><code class="plain">export MALLOC_LOCK_RETRY=</code><code class="value">0</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export OPENCV_FOR_THREADS_NUM=</code><code class="value">3</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export AI_DATA_ROOT=${ASW_PATH}/data/ \</code></div>
<div class="line"><code class="plain">export PNC_DATA_ROOT=${ASW_PATH}/data/ \</code></div>
<div class="line"><code class="plain">export RUNNABLES_DLA_LAZY_INIT=</code><code class="value">1</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export VIPER_NON_CRITICAL_XLOC=</code><code class="value">1</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export GLOG_minloglevel=</code><code class="value">3</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export POSIX_TYPED_MEMORY=/memory/pcie6Memory \</code></div>
<div class="line"><code class="plain">export DLT_PIPE_DIR=/data/ \</code></div>
<div class="line"><code class="plain">export ENABLE_NP=ON \</code></div>
<div class="line"><code class="plain">export TIMETRIGGER_MS=</code><code class="value">10</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">export DISABLE_INTROSPECTION=ON \</code></div>
<div class="line"><code class="plain">export DISABLE_NOTIFY_WAIT_TICK_ERROR=ON \</code></div>
<div class="line"><code class="plain">export DISABLE_ALIVE_CHECK=ON \</code></div>
<div class="line"><code class="plain">export CUDA_CACHE_PATH=/data/ \</code></div>
<div class="line"><code class="plain">export CUDA_DEVICE_MAX_CONNECTIONS=</code><code class="value">16</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>*</p>
</li><li class=" "><p   
> Use the command line NSYS to start VIPERPARKING </p>
</li><li class=" "><p  class="auto-cursor-target" 
> -O/Cache/Update/Madcszh/Standard/NSYSLOG-VIPER%P follows the path of the output report </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/opt/nvidia/nsight_systems/nsys profile -y </code><code class="value">100</code><code class="plain"> -d </code><code class="value">30</code><code class="plain"> -w </code><code class="keyword">true</code><code class="plain"> -t </code><code class="string">"cuda,cudnn,osrt,nvtx,nvmedia,cublas"</code><code class="plain"> -o /cache/update/madcszh/standard/nsyslog-Viper%p  \</code></div>
<div class="line"><code class="plain">--gpu-metrics-frequency=</code><code class="value">10000</code><code class="plain">  --force-overwrite=</code><code class="keyword">true</code><code class="plain"> --cuda-graph-trace=node  \</code></div>
<div class="line"><code class="plain">--cuda-memory-usage=</code><code class="keyword">true</code><code class="plain">  --accelerator-trace=nvmedia --gpu-metrics-device=all --cudabacktrace=all --sampling-frequency=</code><code class="value">500</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">./bin/ViperParking_activity \</code></div>
<div class="line"><code class="plain">-m ${ASW_PATH}yaaac_codegen/carma_0_22_deploy/DualOrinMaster/manifests/roudi_qm_viper_parking.inst \</code></div>
<div class="line"><code class="plain">-d ${ASW_PATH}yaaac_codegen/carma_0_22_deploy/DualOrinMaster/manifests/viper_parking_deploy \</code></div>
<div class="line"><code class="plain">-p ${ASW_PATH}yaaac_parameter_instances \</code></div>
<div class="line"><code class="plain">-c VIPP \</code></div>
<div class="line"><code class="plain">-l </code><code class="value">1</code><code class="plain"> -a </code><code class="value">6</code><code class="plain"> -s </code><code class="value">2</code><code class="plain"> -f /log/ASW/viper_parking</code></div>
</div>
    </div>
</li></ul></li></ul>    </div>
    <div class="section section-1" id="src-3981344302_safe-id-SG93dG91c2VOU1lTdG9wcm9maWxpbmdzdGFuZGFyZGFwcGxpY2F0aW9ucGVyZm9ybWFuY2Ut5YiG5p6Q">
        <h1 class="heading "><span> analyze </span></h1>
<p   
> You can choose to install a Windows version or directly to the X11 on the Host PC, the Run nsys UI open the report to see the offline Analyze </p>
<p   
> Be sure to ensure that the corresponding content of the IGPU is really collected </p>
<p   
><img  class="confluence-embedded-image"  src="images/confluence/download/attachments/3981344302/image-2024-2-22_14-55-42-version-1-modificationdate-1708655617000-api-v2.png" alt="images/confluence/download/attachments/3981344302/image-2024-2-22_14-55-42-version-1-modificationdate-1708655617000-api-v2.png"  height="145" />
    </p>
<p   
><br/></p>
<p   
><br/></p>
<p   
><br/></p>
<p   
><br/></p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="3699957039_Handle_Sync-Api__%26_cuda_graph.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Handle Sync-Api  & cuda graph</span>
        </a>
                <a href="3228797983_PI2309_PER_Real-Time_Performance_Optimization_Tracking.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>PI2309 PER Real-Time Performance Optimization Tracking</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>


    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
